<!DOCTYPE html>
<meta charset="utf-8">
<style>
 
body {
    background: #222;
    font-family: sans-serif;
    font-style: italic;
}
 
</style>
<body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script>

var CLICK_DISTANCE = 4,
    CLICK_DISTANCE_2 = CLICK_DISTANCE * CLICK_DISTANCE;

var curling = d3.select('body');
var width = 500,
    height = 1000,
    sixfeet = width / 2 *0.9,
    rockwidth = sixfeet / 6 * 10 / 12,
    spacer = rockwidth/4;

var radii = {
    "twelve": sixfeet,
    "eight": sixfeet*2/3,
    "four": sixfeet/3,
    "button": sixfeet/12,
};

var rocks = []
var row = 0, col = 1;
for (let i = 1; i <= 8; ++i) {
    col = i % 2 + 1;
    if (i%2) row++;
    let x = rockwidth * col + spacer * (i%2) + 1
    let y = rockwidth * row + spacer * (row-1)
    rocks.push({x: x, y: y, id: `red${i}`, color: "red"})

    x = width - rockwidth * col - spacer * (i%2) + 1
    y = rockwidth * row + spacer * (row-1)
    rocks.push({x: x, y: y, id: `yel${i}`, color: "yellow"})
        
}
 

var svg = curling.append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
        // .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

//sheet
svg.append("rect")
    .attr("class", "sheet")
    .attr("width", width)
    .attr("height", height)
    .attr("x", 0)
    .attr("y", 0)
    .style("fill", "white")

svg.append("circle")
    .attr("class", "twelve")
    .attr("class", "house")
    .attr("r", radii.twelve)
    .attr("cx", width/2)
    .attr("cy", radii.twelve + sixfeet)
    .style("fill", "blue")

svg.append("circle")
    .attr("class", "eight")
    .attr("class", "house")
    .attr("r", radii.eight)
    .attr("cx", width/2)
    .attr("cy", radii.twelve + sixfeet)
    .style("fill", "white")

svg.append("circle")
    .attr("class", "four")
    .attr("class", "house")
    .attr("r", radii.four)
    .attr("cx", width/2)
    .attr("cy", radii.twelve + sixfeet)
    .style("fill", "red")

svg.append("circle")
    .attr("class", "button")
    .attr("class", "house")
    .attr("r", radii.button)
    .attr("cx", width/2)
    .attr("cy", radii.twelve + sixfeet)
    .style("fill", "white")

var backline = 5
svg.append("line")
    .attr("x1", 0)
    .attr("y1", sixfeet - backline/2)
    .attr("x2", width)
    .attr("y2", sixfeet - backline/2)
    .style("stroke", "black")
    .style("stroke-width", backline)

const newData = svg
    .selectAll("rock")
    .data(rocks)
    .join("circle")
    .attr("class", "rock")
    .attr("class", d => d.id)
    .attr("r", rockwidth/2)
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .style("fill", d => d.color)
    .style("stroke", "grey")
    .style("stroke-width", rockwidth/5)
    .call(d3.drag()
        .clickDistance(CLICK_DISTANCE)
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

function clicked(d, i) {
    if (d3.event.defaultPrevented) return; // dragged
}

function dragstarted(d) {
  d.startX = d3.event.sourceEvent.clientX;
  d.startY = d3.event.sourceEvent.clientY;
}

function dragged(d) {
  var e = d3.select(this),
      dStartX = d.startX - d3.event.sourceEvent.clientX,
      dStartY = d.startY - d3.event.sourceEvent.clientY;

  if (dStartX * dStartX + dStartY * dStartY > CLICK_DISTANCE_2 &&
      !e.classed("active")) {

    e.raise().classed("active", true);
  }

  e.attr("cx", d.x = d3.event.x).attr("cy", d.y = d3.event.y);
}

function dragended(d) {
  d3.select(this).classed("active", false);
}

</script>
